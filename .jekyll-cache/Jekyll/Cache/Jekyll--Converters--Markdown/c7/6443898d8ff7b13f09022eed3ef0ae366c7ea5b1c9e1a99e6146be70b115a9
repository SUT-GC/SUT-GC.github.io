I"¼Ê<ul class="toc" id="markdown-toc">
  <li><a href="#heading-ä»€ä¹ˆæ˜¯è·¨åŸŸ" id="markdown-toc-heading-ä»€ä¹ˆæ˜¯è·¨åŸŸ">ä»€ä¹ˆæ˜¯è·¨åŸŸ</a></li>
  <li><a href="#heading-ä¸ºä»€ä¹ˆä¼šæœ‰è·¨åŸŸ" id="markdown-toc-heading-ä¸ºä»€ä¹ˆä¼šæœ‰è·¨åŸŸ">ä¸ºä»€ä¹ˆä¼šæœ‰è·¨åŸŸ</a>    <ul>
      <li><a href="#heading-æµè§ˆå™¨é™åˆ¶" id="markdown-toc-heading-æµè§ˆå™¨é™åˆ¶">æµè§ˆå™¨é™åˆ¶</a></li>
      <li><a href="#heading-è·¨åŸŸ" id="markdown-toc-heading-è·¨åŸŸ">è·¨åŸŸ</a></li>
      <li><a href="#heading-xhrè¯·æ±‚" id="markdown-toc-heading-xhrè¯·æ±‚">XHRè¯·æ±‚</a></li>
    </ul>
  </li>
  <li><a href="#heading-æ€ä¹ˆè§£å†³è·¨åŸŸ" id="markdown-toc-heading-æ€ä¹ˆè§£å†³è·¨åŸŸ">æ€ä¹ˆè§£å†³è·¨åŸŸ</a>    <ul>
      <li><a href="#heading-å¦‚ä½•ä»è§£å†³æµè§ˆå™¨é™åˆ¶" id="markdown-toc-heading-å¦‚ä½•ä»è§£å†³æµè§ˆå™¨é™åˆ¶">å¦‚ä½•ä»è§£å†³æµè§ˆå™¨é™åˆ¶</a>        <ul>
          <li><a href="#heading-æµè§ˆå™¨åˆ¶å®šå¯åŠ¨å‚æ•°" id="markdown-toc-heading-æµè§ˆå™¨åˆ¶å®šå¯åŠ¨å‚æ•°">æµè§ˆå™¨åˆ¶å®šå¯åŠ¨å‚æ•°</a></li>
        </ul>
      </li>
      <li><a href="#heading-ä¸å‘å‡ºxhrè¯·æ±‚" id="markdown-toc-heading-ä¸å‘å‡ºxhrè¯·æ±‚">ä¸å‘å‡ºXHRè¯·æ±‚</a>        <ul>
          <li><a href="#heading-jsonp" id="markdown-toc-heading-jsonp">JsonP</a></li>
        </ul>
      </li>
      <li><a href="#heading-è§£å†³è·¨åŸŸ" id="markdown-toc-heading-è§£å†³è·¨åŸŸ">è§£å†³è·¨åŸŸ</a>        <ul>
          <li><a href="#heading-å¸¸ç”¨çš„bsæ¶æ„" id="markdown-toc-heading-å¸¸ç”¨çš„bsæ¶æ„">å¸¸ç”¨çš„BSæ¶æ„</a></li>
          <li><a href="#heading-bsæ¶æ„è·¨åŸŸ" id="markdown-toc-heading-bsæ¶æ„è·¨åŸŸ">BSæ¶æ„ï¼Œè·¨åŸŸ</a></li>
        </ul>
      </li>
      <li><a href="#heading-è°ƒç”¨æ–¹ä¿®æ”¹" id="markdown-toc-heading-è°ƒç”¨æ–¹ä¿®æ”¹">è°ƒç”¨æ–¹ä¿®æ”¹</a>        <ul>
          <li><a href="#heading-åå‘ä»£ç†" id="markdown-toc-heading-åå‘ä»£ç†">åå‘ä»£ç†</a></li>
          <li><a href="#heading-nginx-é…ç½®" id="markdown-toc-heading-nginx-é…ç½®">Nginx é…ç½®</a></li>
        </ul>
      </li>
      <li><a href="#heading-è¢«è°ƒç”¨æ–¹ä¿®æ”¹" id="markdown-toc-heading-è¢«è°ƒç”¨æ–¹ä¿®æ”¹">è¢«è°ƒç”¨æ–¹ä¿®æ”¹</a>        <ul>
          <li><a href="#heading-å®ç°ä»£ç " id="markdown-toc-heading-å®ç°ä»£ç ">å®ç°ä»£ç </a></li>
          <li><a href="#heading-å…ˆåˆ¤æ–­åæ‰§è¡Œ" id="markdown-toc-heading-å…ˆåˆ¤æ–­åæ‰§è¡Œ">å…ˆåˆ¤æ–­ï¼Œåæ‰§è¡Œ</a></li>
          <li><a href="#heading--ä¸æ˜¯ä¸‡èƒ½çš„" id="markdown-toc-heading--ä¸æ˜¯ä¸‡èƒ½çš„">* ä¸æ˜¯ä¸‡èƒ½çš„</a></li>
          <li><a href="#heading-è‡ªå®šä¹‰è¯·æ±‚å¤´" id="markdown-toc-heading-è‡ªå®šä¹‰è¯·æ±‚å¤´">è‡ªå®šä¹‰è¯·æ±‚å¤´</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#heading-æ€»ç»“" id="markdown-toc-heading-æ€»ç»“">æ€»ç»“</a></li>
</ul>

<h1 id="heading-ä»€ä¹ˆæ˜¯è·¨åŸŸ">ä»€ä¹ˆæ˜¯è·¨åŸŸ</h1>

<p>è·¨åŸŸï¼ŒæŒ‡çš„æ˜¯æµè§ˆå™¨ä¸èƒ½æ‰§è¡Œå…¶ä»–ç½‘ç«™çš„è„šæœ¬ã€‚å®ƒæ˜¯ç”±æµè§ˆå™¨çš„åŒæºç­–ç•¥é€ æˆçš„ï¼Œæ˜¯æµè§ˆå™¨æ–½åŠ çš„å®‰å…¨é™åˆ¶ã€‚</p>

<p>æ‰€è°“åŒæºæ˜¯æŒ‡ï¼ŒåŸŸåï¼Œåè®®ï¼Œç«¯å£å‡ç›¸åŒï¼Œä¸æ˜ç™½æ²¡å…³ç³»ï¼Œä¸¾ä¸ªæ —å­ï¼š</p>

<p>ä½ çš„æœåŠ¡URLæ˜¯ localhost:12345, å½“ä½ å†è¿™ä¸ªURLçš„ç•Œé¢jsæ–‡ä»¶é‡Œè®¿é—® localhost:12346 çš„åœ°å€æ—¶ï¼Œä¼šè¢«ç¦æ­¢ï¼Œè¯¥é—®é¢˜ä¸ºè·¨åŸŸé—®é¢˜ã€‚</p>

<p>æˆ‘ä»¬ç”¨ä»£ç æ¥å®ç°è·¨åŸŸ:</p>

<p>åç«¯ä»£ç :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// URL localhost:8888/cross</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CrossDomainController</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/cross"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getHelloWorld</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"hello world"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>åœ¨æµè§ˆå™¨è¾“å…¥ <code class="language-plaintext highlighter-rouge">localhost:8888/cross</code> ç»“æœå¦‚ä¸‹:</p>

<p><img src="/files/images/cross-1.png" alt="cross-1" /></p>

<p>å‰ç«¯ä»£ç :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">data</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">msg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">created</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$http</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://localhost:8888/cross</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">bodyText</span>
    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">get Error</span><span class="dl">'</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span>
</code></pre></div></div>

<p>æˆ‘ä»¬è·‘ä¸€ä¸‹ç»“æœå¦‚ä¸‹:</p>

<p><img src="/files/images/cross-2.png" alt="cross-2" /></p>

<p>ç„¶åæ¥çœ‹ä¸‹ control:</p>

<p><img src="/files/images/cross-3.png" alt="cross-3" /></p>

<p><code class="language-plaintext highlighter-rouge">Failed to load http://localhost:8888/cross: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:8080' is therefore not allowed access</code>  çš„æ„æ€å¤§è‡´æ˜¯ <code class="language-plaintext highlighter-rouge">http://localhost:8888/crossåŠ è½½å¤±è´¥ï¼Œ å› ä¸ºåœ¨ è¯·æ±‚http://localhost:8888/crossçš„è¿”å›å¤´é‡Œé¢æ²¡æœ‰ Access-Control-Allow-Origin, æ‰€ä»¥ http://localhost:8080 çš„è®¿é—®è¢«æ‹’ç»</code></p>

<h1 id="heading-ä¸ºä»€ä¹ˆä¼šæœ‰è·¨åŸŸ">ä¸ºä»€ä¹ˆä¼šæœ‰è·¨åŸŸ</h1>

<p>å‘ç”Ÿè·¨åŸŸé—®é¢˜å¤§æ¦‚æœ‰ä¸‰ä¸ªåŸå› :</p>

<h2 id="heading-æµè§ˆå™¨é™åˆ¶">æµè§ˆå™¨é™åˆ¶</h2>

<p>å…¶å®è·¨åŸŸé—®é¢˜æ˜¯æµè§ˆå™¨åšçš„é™åˆ¶ï¼Œè€Œä¸æ˜¯æœåŠ¡å™¨åå°çš„é™åˆ¶ï¼Œ å½“æµè§ˆå™¨å‘ç°è¯·æ±‚æ˜¯è·¨åŸŸçš„ï¼Œå°±ä¼šå»æ ¡éªŒè·¨åŸŸè¯·æ±‚çš„è¿”å›å€¼é‡Œé¢æ˜¯å¦æœ‰ä¸€äº›å…è®¸è·¨åŸŸçš„æ ‡ç¤ºï¼Œ å¦‚æœæ²¡æœ‰è¿™äº›æ ‡ç¤ºï¼Œåˆ™æµè§ˆå™¨æŠ¥è·¨åŸŸå¼‚å¸¸ã€‚</p>

<h2 id="heading-è·¨åŸŸ">è·¨åŸŸ</h2>

<p>è¿™ä¸ªå°±æ˜¯è¯´ å½“ä½ è¯·æ±‚çš„åœ°å€ è·Ÿä½ å½“å‰çš„åœ°å€ æœ‰ ip/ç«¯å£/åè®® æœ‰ä»»ä½•ä¸€ä¸ªä¸ä¸€æ ·ï¼Œå°±ä¼šå‘ç”Ÿè·¨åŸŸã€‚</p>

<h2 id="heading-xhrè¯·æ±‚">XHRè¯·æ±‚</h2>

<p>å½“è¯·æ±‚æ˜¯XHR(XmlHttpRequest)çš„æ—¶å€™ï¼Œ æµè§ˆå™¨å°±ä¼šå»åˆ¤æ–­æ˜¯å¦è·¨åŸŸã€‚ è¿™ä¸ªå¾ˆå¥½éªŒè¯ï¼Œæ¯”å¦‚åœ¨<code class="language-plaintext highlighter-rouge">localhost:8080</code>ç•Œé¢ä¸­ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">&lt;a href="localhost:8888/cross"&gt;</code> æ ‡ç­¾ï¼Œå¹¶ä¸ä¼šè¢«æµè§ˆå™¨è¯†åˆ«è·¨åŸŸã€‚</p>

<h1 id="heading-æ€ä¹ˆè§£å†³è·¨åŸŸ">æ€ä¹ˆè§£å†³è·¨åŸŸ</h1>

<p>è§£å†³æ€è·¯ä¹Ÿæ˜¯æ ¹æ®äº§ç”Ÿçš„åŸå› å»æ‰¾å¯¹åº”çš„ç­–ç•¥:</p>

<h2 id="heading-å¦‚ä½•ä»è§£å†³æµè§ˆå™¨é™åˆ¶">å¦‚ä½•ä»è§£å†³æµè§ˆå™¨é™åˆ¶</h2>

<h3 id="heading-æµè§ˆå™¨åˆ¶å®šå¯åŠ¨å‚æ•°">æµè§ˆå™¨åˆ¶å®šå¯åŠ¨å‚æ•°</h3>

<p>åœ¨æ‰“å¼€æµè§ˆå™¨çš„æ—¶å€™ å¯ä»¥å¢åŠ ä¸€ä¸ªå‚æ•° <code class="language-plaintext highlighter-rouge">--disable-web-security</code></p>

<p><code class="language-plaintext highlighter-rouge">open -n Google\ Chrome.app/ --args --disable-web-security --user-data-dir=éšä¾¿ä¸€ä¸ªç›®å½•</code></p>

<p>æ‰“å¼€ä¹‹åçš„æ•ˆæœå¦‚ä¸‹:</p>

<p><img src="/files/images/cross-4.png" alt="cross-4" /></p>

<p>æˆ‘ä»¬å†çœ‹çœ‹ä¹‹å‰çš„é¡µé¢è¯·æ±‚:</p>

<p><img src="/files/images/cross-5.png" alt="corss-5" /></p>

<p>æˆ‘ä»¬å‘ç° è·¨åŸŸé—®é¢˜å·²ç»æ²¡æœ‰äº†ï¼Œ <strong>ä¸è¿‡è¿™ä¸æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„è§£å†³åŠæ³•ã€‚</strong></p>

<h2 id="heading-ä¸å‘å‡ºxhrè¯·æ±‚">ä¸å‘å‡ºXHRè¯·æ±‚</h2>

<h3 id="heading-jsonp">JsonP</h3>

<h4 id="heading-jsonp-æ˜¯ä»€ä¹ˆ">JsonP æ˜¯ä»€ä¹ˆï¼Ÿ</h4>

<p>jsonP æ˜¯ jsonçš„ä¸€ä¸ªæ‰©å±•ï¼Œ ä¸»è¦æ˜¯ä½¿ç”¨javascriptè„šæœ¬ä»£æ›¿xhrè¯·æ±‚æ¥è§£å†³è·¨åŸŸ</p>

<p><strong>jsonP æœåŠ¡åå°ä»£ç ä¹Ÿæ˜¯è¦ä¿®æ”¹çš„</strong></p>

<p>æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹å‰å°çš„ä»£ç :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">data</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">msg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">created</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$http</span><span class="p">.</span><span class="nx">jsonp</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://localhost:8888/cross</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">bodyText</span>
    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">get Error</span><span class="dl">'</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span>
</code></pre></div></div>

<p>çœ‹ä¸‹è¯·æ±‚ç»“æœ:</p>

<p><img src="/files/images/cross-6.png" alt="cross-6" /></p>

<p>æˆ‘ä»¬å‘ç°æµè§ˆå™¨æŠ¥é”™æ¢äº†ï¼Œ ä¸ºä»€ä¹ˆè¿™æ ·å‘¢ï¼Ÿ å› ä¸ºjsonPè¯·æ±‚ä¼šå°†è¿”å›ä½“å½“ä½œä¸€æ®µjsä»£ç æ¥ä½¿ç”¨ï¼Œ æˆ‘ä»¬åæ®µè¿”å› <code class="language-plaintext highlighter-rouge">hello world</code> å¹¶ä¸æ˜¯jsçš„è¯­æ³•ï¼Œæ‰€ä»¥å‰ç«¯è§£æå¤±è´¥ï¼Œ æ‰€ä»¥ä½¿ç”¨jsonpè¦å¯¹åæ®µä»£ç è¿›è¡Œæ”¹åŠ¨ï¼Œ æˆ‘ä»¬æ”¹æˆå¦‚ä¸‹ä»£ç :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CrossDomainController</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/cross"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getHelloWorld</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"hello world"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/cross/bean"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseBean</span> <span class="nf">getHelloWorldBean</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseBean</span><span class="o">()</span> <span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ResponseBean</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">data</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@ControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonPAdvice</span> <span class="kd">extends</span> <span class="nc">AbstractJsonpResponseBodyAdvice</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">JsonPAdvice</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="s">"callback"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">data</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">msg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">created</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$http</span><span class="p">.</span><span class="nx">jsonp</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://localhost:8888/cross/bean</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span>
    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">get Error</span><span class="dl">'</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span></code></pre></div></div>

<p>å…ˆè¯´ä¸€ä¸‹ï¼Œ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨<code class="language-plaintext highlighter-rouge">/cross/bean</code> å› ä¸ºjsonpè¿”å›çš„ä¸œè¥¿ï¼Œæµè§ˆå™¨å½“æˆjavascriptè„šæœ¬æ¥ä½¿ç”¨ï¼Œ <code class="language-plaintext highlighter-rouge">/cross</code>è¿”å›çš„ hello world ä¸ç¬¦åˆjsçš„è¯­æ³•ï¼Œæ‰€ä»¥ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚</p>

<p>æˆ‘ä»¬çœ‹ä¸‹è¿è¡Œç»“æœ</p>

<p><img src="/files/images/corss-7.png" alt="cross-7" /></p>

<p>æˆ‘ä»¬å‘ç°ï¼Œ response ä¸å†æ˜¯jsonç±»å‹ï¼Œ request ä¹Ÿä¸åœ¨æ—¶xhrç±»å‹ï¼Œ æ‰€ä»¥è¯æ˜ jsonpåªæ˜¯å°†åç«¯è¿”å›å½“æˆjavascriptè„šæœ¬æ¥è¿è¡Œ</p>

<h4 id="heading-jsonp-çš„å¼Šç«¯">JsonP çš„å¼Šç«¯</h4>

<ol>
  <li>æœåŠ¡å™¨éœ€è¦æ”¹åŠ¨ä»£ç </li>
</ol>

<p>å¦‚æœæœåŠ¡å™¨ç«¯ä¸æ˜¯è‡ªå·±çš„ï¼Œ å°±æ²¡æœ‰åŠæ³•æ”¹åŠ¨æœåŠ¡å™¨ä»£ç </p>

<ol>
  <li>åªæ”¯æŒGETæ–¹æ³•</li>
</ol>

<p>å› ä¸ºæ˜¯é€šè¿‡åŠ¨æ€åˆ›å»ºscriptè„šæœ¬æ¥å‘é€è¯·æ±‚ï¼Œ æ‰€ä»¥é™¤äº†GETæ–¹æ³•ï¼Œå…¶ä»–çš„éƒ½ä¸æ”¯æŒã€‚</p>

<ol>
  <li>å‘å‡ºå»çš„ä¸æ˜¯XHRè¯·æ±‚</li>
</ol>

<p>è¿™ä¹Ÿæ˜¯jsonPä¸ºä»€ä¹ˆå¯ä»¥è§£å†³è·¨åŸŸçš„æ ¹æœ¬åŸå› ï¼Œ ä¸èƒ½ä½¿ç”¨XHRä¸€äº›ç‰¹æ€§</p>

<h2 id="heading-è§£å†³è·¨åŸŸ">è§£å†³è·¨åŸŸ</h2>

<h3 id="heading-å¸¸ç”¨çš„bsæ¶æ„">å¸¸ç”¨çš„BSæ¶æ„</h3>

<p><img src="/files/images/cross-8.png" alt="cross-8" /></p>

<p>æˆ‘ä»¬å¸¸ç”¨çš„Browser/Server æ¶æ„å¦‚å›¾æ‰€ç¤ºï¼Œ Browser ç«¯å‘èµ·è¯·æ±‚ åˆ° ä¸­é—´æœåŠ¡å™¨(Apache or Nginx), ä¸­é—´æœåŠ¡å™¨åˆ¤æ–­è¯¥è¯·æ±‚æ˜¯è¯·æ±‚é™æ€èµ„æºï¼Œè¿˜æ˜¯è¯·æ±‚åŠ¨æ€èµ„æºï¼Ÿ å¦‚æœæ˜¯è¯·æ±‚é™æ€èµ„æºï¼Œåˆ™èµ°Aé“¾è·¯ï¼Œ å¦‚æœè¯·æ±‚åŠ¨æ€èµ„æºåˆ™èµ°Bé“¾è·¯ã€‚</p>

<ul>
  <li>Aé“¾è·¯: å¦‚htmlï¼Œ cssï¼Œ jsï¼Œ img ç­‰è¿™äº›é™æ€èµ„æº</li>
  <li>Bé“¾è·¯: å¦‚postï¼Œgetï¼Œdelete è¿™äº›è¯·æ±‚</li>
</ul>

<h3 id="heading-bsæ¶æ„è·¨åŸŸ">BSæ¶æ„ï¼Œè·¨åŸŸ</h3>

<p><img src="/files/images/cross-9.png" alt="cross-9" /></p>

<p>å¦‚å›¾æ‰€ç¤ºï¼Œ å½“è°ƒç”¨æ–¹Aåœ¨Browserï¼ˆæµè§ˆå™¨ï¼‰ç«¯è¯·æ±‚ è¢«è°ƒç”¨æ–¹Bçš„æ—¶å€™ï¼Œå°±ä¼šå‘ç”Ÿè·¨åŸŸé—®é¢˜ï¼Œ é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>

<p><img src="/files/images/cross-10.png" alt="cross-10" /></p>

<p>æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š</p>

<ul>
  <li>ä¿®æ”¹è¢«è°ƒç”¨æ–¹ï¼Œä½¿å…¶åœ¨headeré‡Œé¢è¿”å›ä¸€äº›æ ‡ç¤ºï¼Œæ¥æ ‡è®°è¯¥æœåŠ¡æ”¯æŒè·¨åŸŸ</li>
  <li>ä¿®æ”¹è°ƒç”¨æ–¹ï¼Œä½¿ç”¨Apache/Nginxçš„ä¸€äº›é…ç½®ï¼Œè®©æµè§ˆå™¨è¯·æ±‚Apache/Nginxï¼Œç”±Apache/Nginxè½¬å‘åˆ°è¢«è°ƒç”¨æ–¹Bçš„è¯·æ±‚ï¼Œè®©æµè§ˆå™¨æ„Ÿè§‰ä¸åˆ°è·¨åŸŸã€‚</li>
</ul>

<p>å¥½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªçš„å®ç°</p>

<h2 id="heading-è°ƒç”¨æ–¹ä¿®æ”¹">è°ƒç”¨æ–¹ä¿®æ”¹</h2>

<p>è°ƒç”¨æ–¹è§£å†³æ–¹æ¡ˆ å°±æ˜¯å½“æ²¡æœ‰åŠæ³•ä¿®æ”¹è¢«è°ƒç”¨æ–¹çš„æœåŠ¡å™¨ä»£ç æ—¶ï¼Œå°±è¦åœ¨è°ƒç”¨æ–¹è¯·æ±‚å¤„æƒ³åŠæ³•è§£å†³è·¨åŸŸï¼Œ å¯ä»¥ä½¿ç”¨åå‘ä»£ç†æ–¹å¼ã€‚</p>

<h3 id="heading-åå‘ä»£ç†">åå‘ä»£ç†</h3>

<p>åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—internetä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚</p>

<p>è¯´ç™½äº†ï¼Œå°±æ˜¯ æµè§ˆå™¨è®¿é—®åŒä¸€ä¸ªurlä¸Šçš„ä¸åŒåœ°å€ï¼Œ å¦‚ localhost:8080/A, localhost:8080/B, ç„¶ååå‘ä»£ç†æœåŠ¡å™¨å¯ä»¥æŠŠè¯·æ±‚é“¾æ¥ä»£ç†åˆ°ä¸åŒåœ°å€çš„æœåŠ¡å™¨ä¸Š ï¼Œå¦‚NginxæŠŠ localhost:8080/B  ä»£ç†åˆ° localhost:8081 ä¸Šï¼Œ æµè§ˆå™¨ æ„Ÿè§‰ä¸å‡ºæ¥è·¨åŸŸï¼Œ ä¹Ÿå°±æ˜¯éšè—è·¨åŸŸã€‚</p>

<h3 id="heading-nginx-é…ç½®">Nginx é…ç½®</h3>

<p>æˆ‘ä»¬å…ˆæŠŠ å‰åç«¯ä»£ç æ”¹æˆä¸èƒ½è·¨åŸŸçš„</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CrossFilter</span> <span class="kd">implements</span> <span class="n">javax</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">Filter</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">HttpServletResponse</span> <span class="n">resp</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="n">response</span><span class="o">;</span>

        <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">data</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">msg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">created</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://localhost:8888/cross/bean</span><span class="dl">'</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="na">data</span><span class="p">:</span> <span class="dl">"</span><span class="s2">gc</span><span class="dl">"</span><span class="p">})).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span>
    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">get Error</span><span class="dl">'</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span></code></pre></div></div>

<p><img src="/files/images/cross-16.png" alt="cross-16" /></p>

<p>æˆ‘ä»¬çœ‹ ç°åœ¨æ˜¯ä¸å…è®¸è·¨åŸŸçš„ï¼Œ ç°åœ¨æˆ‘ä»¬é…ç½®ä¸‹nginx:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">server</span> <span class="p">{</span>
  <span class="nx">listen</span> <span class="mi">80</span><span class="p">;</span>
  <span class="nx">server_name</span> <span class="nx">localhost</span><span class="p">;</span>

  <span class="nx">location</span> <span class="o">/</span> <span class="p">{</span>
      <span class="nx">proxy_pass</span> <span class="na">http</span><span class="p">:</span><span class="c1">//localhost:8081;</span>
  <span class="p">}</span>

  <span class="nx">location</span> <span class="o">/</span><span class="nx">ajaxserver</span><span class="p">{</span>
      <span class="nx">proxy_pass</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//localhost:8888/cross/bean;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>çœ‹è¿™ä¸ªnginxçš„é…ç½®ï¼Œ æˆ‘ä»¬æŠŠ <code class="language-plaintext highlighter-rouge">localhost</code>  è·¯ç”±åˆ° <code class="language-plaintext highlighter-rouge">http://localhost:8081</code> è·¯å¾„ä¸Šï¼Œ æˆ‘ä»¬æŠŠ  <code class="language-plaintext highlighter-rouge">localhost/ajaxserver</code> è·¯ç”±åˆ° <code class="language-plaintext highlighter-rouge">http://localhost:8888/cross/bean</code>ï¼Œ ç„¶åæˆ‘ä»¬å†æ”¹ä¸‹ å‰ç«¯è¯·æ±‚çš„è·¯å¾„:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">data</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">msg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">created</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/ajaxserver</span><span class="dl">'</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="na">data</span><span class="p">:</span> <span class="dl">"</span><span class="s2">gc</span><span class="dl">"</span><span class="p">})).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span>
    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">get Error</span><span class="dl">'</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span></code></pre></div></div>

<p><img src="/files/images/cross-17.png" alt="cross-17" /></p>

<p>æˆ‘ä»¬çœ‹ï¼Œæµè§ˆå™¨å·²ç»ä¸æ˜¾ç¤ºè·¨åŸŸäº†ã€‚ è¿™æ · æˆ‘ä»¬æˆåŠŸçš„å¯¹æµè§ˆå™¨éšè—äº†è·¨åŸŸã€‚</p>

<h2 id="heading-è¢«è°ƒç”¨æ–¹ä¿®æ”¹">è¢«è°ƒç”¨æ–¹ä¿®æ”¹</h2>

<h3 id="heading-å®ç°ä»£ç ">å®ç°ä»£ç </h3>

<p><img src="/files/images/cross-11.png" alt="cross-11" /></p>

<p>è¢«è°ƒç”¨æ–¹ä¿®æ”¹ï¼Œå°±æ˜¯åœ¨è¯·æ±‚çš„å“åº”å¤´ä¸­å¢åŠ ä¸€äº›æ ‡ç¤ºï¼Œè®©æµè§ˆå™¨å…è®¸è·¨åŸŸï¼Œ å¯ä»¥ä¿®æ”¹ç›¸åº”å¤´çš„åœ°æ–¹æœ‰ä¸¤å¤„ï¼Œ è¿™é‡Œåªä»‹ç»åœ¨åç«¯ä»£ç é‡Œå¦‚ä½•ä¿®æ”¹å“åº”å¤´ï¼Œ Apache/Nginx æœåŠ¡å™¨ä¸Šä¿®æ”¹çš„æ–¹æ³•ï¼Œæœ¬æ–‡ä¸åšæ¼”ç¤º</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ComponentScan</span><span class="o">(</span><span class="s">"me.int32"</span><span class="o">)</span>
<span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableAutoConfiguration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">FilterRegistrationBean</span> <span class="nf">registerFilter</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">FilterRegistrationBean</span> <span class="n">bean</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FilterRegistrationBean</span><span class="o">();</span>
        <span class="n">bean</span><span class="o">.</span><span class="na">addUrlPatterns</span><span class="o">(</span><span class="s">"*"</span><span class="o">);</span>
        <span class="n">bean</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span><span class="k">new</span> <span class="nc">CrossFilter</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kn">package</span> <span class="nn">me.int32.filter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CrossFilter</span> <span class="kd">implements</span> <span class="n">javax</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">Filter</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">HttpServletResponse</span> <span class="n">resp</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="n">response</span><span class="o">;</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Access-Control-Allow-Origin"</span><span class="o">,</span> <span class="s">"*"</span><span class="o">);</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Access-Control-Allow-Methods"</span><span class="o">,</span> <span class="s">"*"</span><span class="o">);</span>

        <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">data</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">msg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">created</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$http</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://localhost:8888/cross/bean</span><span class="dl">'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span>
    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">get Error</span><span class="dl">'</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span></code></pre></div></div>

<p><img src="/files/images/cross-12.png" alt="cross-12" /></p>

<p>å¯ä»¥çœ‹åˆ°Response Header é‡Œé¢å¸¦äº† <code class="language-plaintext highlighter-rouge">Access-Control-Allow-Methods:*</code>  å’Œ <code class="language-plaintext highlighter-rouge">Access-Control-Allow-Origin:*</code> ä¸¤ä¸ªæ ‡ç¤ºï¼Œ ä»£è¡¨ç€ï¼Œ å…è®¸æµè§ˆå™¨å¯¹æ‰€æœ‰æºï¼Œæ‰€æœ‰æ–¹æ³•è¿›è¡Œè·¨åŸŸè¯·æ±‚.</p>

<h3 id="heading-å…ˆåˆ¤æ–­åæ‰§è¡Œ">å…ˆåˆ¤æ–­ï¼Œåæ‰§è¡Œ</h3>

<p>æµè§ˆå™¨çš„è¯·æ±‚å¹¶ä¸éƒ½æ˜¯å…ˆæ‰§è¡Œååˆ¤æ–­ï¼Œå³å…ˆè¯·æ±‚æœåŠ¡æ¥å£ï¼Œ æ ¹æ®æœåŠ¡æ¥å£çš„å“åº”å¤´å»åˆ¤æ–­æ˜¯å¦å…è®¸è·¨åŸŸï¼Œ ä¹Ÿæœ‰ä¸€äº›è¯·æ±‚æ˜¯å…ˆå‘ä¸€ä¸ªé¢„å¤„ç†è¯·æ±‚ï¼Œè¿™ä¸ªé¢„å¤„ç†è¯·æ±‚å°±åŒ…æ‹¬åˆ¤æ–­æ˜¯å¦è·¨åŸŸï¼Œ å¦‚æœå…è®¸è·¨åŸŸï¼Œæ‰ä¼šå‘é€çœŸæ­£çš„è¯·æ±‚ã€‚</p>

<p>å“ªäº›æ˜¯éœ€è¦å‘é¢„å¤„ç†è¯·æ±‚ï¼ˆå¤æ‚è¯·æ±‚ï¼‰ï¼Œå“ªäº›æ˜¯ä¸éœ€è¦ï¼ˆç®€å•è¯·æ±‚ï¼‰çš„å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥è¿™æ ·åŒºåˆ†ï¼š</p>

<ul>
  <li>ç®€å•è¯·æ±‚ï¼š
    <ul>
      <li>GETï¼ŒPOSTï¼ŒHEAD æ–¹æ³•ä¸­çš„ä¸€ç§</li>
      <li>æ— è‡ªå®šä¹‰å¤´</li>
      <li>Content-Type in [text/plain, multipart/form-data, appliocation/x-www-form-urlencoded]</li>
    </ul>
  </li>
  <li>å¤æ‚è¯·æ±‚:</li>
  <li>PUT, DELETE æ–¹æ³•çš„ajaxè¯·æ±‚</li>
  <li>å‘é€jsonæ ¼å¼çš„ ajax è¯·æ±‚</li>
  <li>å¸¦è‡ªå®šä¹‰å¤´çš„ ajax è¯·æ±‚</li>
</ul>

<p>æˆ‘ä»¬æ¥å‘é€ä¸€ä¸ªå¤æ‚è¯·æ±‚ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CrossDomainController</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/cross"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getHelloWorld</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"hello world"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/cross/bean"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseBean</span> <span class="nf">getHelloWorldBean</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseBean</span><span class="o">()</span> <span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/cross/bean"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseBean</span> <span class="nf">getRequestBean</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">RequestBean</span> <span class="n">requestBean</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"....."</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseBean</span><span class="o">()</span> <span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">data</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">msg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">created</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://localhost:8888/cross/bean</span><span class="dl">'</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="na">data</span><span class="p">:</span> <span class="dl">"</span><span class="s2">gc</span><span class="dl">"</span><span class="p">})).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span>
    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">get Error</span><span class="dl">'</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span></code></pre></div></div>

<p><img src="/files/images/cross-13.png" alt="cross-13" />
<img src="/files/images/cross-14.png" alt="cross-14" /></p>

<p>æˆ‘ä»¬çœ‹ä¸‹ï¼Œ è¿™ç§ajax json post è¯·æ±‚ï¼Œå¹¶ä¸å•å•æ˜¯å‘é€ä¸€ä¸ªpostï¼Œ è€Œæ˜¯å…ˆå‘é€ä¸€ä¸ª method=OPETION çš„é¢„æ£€è¯·æ±‚ï¼Œ ä½†æ˜¯ç”±äºé¢„æ£€è¯·æ±‚æ²¡æœ‰è¢«é€šè¿‡ ï¼š æˆ‘ä»¬çœ‹åˆ° å‰ç«¯éœ€è¦åç«¯å›ç»™ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Access-Control-Allow-Headers:Content-Type</code> , æˆ‘ä»¬ä¿®æ”¹ä¸‹åç«¯ä»£ç :</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CrossFilter</span> <span class="kd">implements</span> <span class="n">javax</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">Filter</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">HttpServletResponse</span> <span class="n">resp</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="n">response</span><span class="o">;</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Access-Control-Allow-Origin"</span><span class="o">,</span> <span class="s">"*"</span><span class="o">);</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Access-Control-Allow-Methods"</span><span class="o">,</span> <span class="s">"*"</span><span class="o">);</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Access-Control-Allow-Headers"</span><span class="o">,</span> <span class="s">"Content-Type"</span><span class="o">);</span>

        <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><img src="/files/images/corss-15.png" alt="cross-15" /></p>

<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¯·æ±‚å·²ç»æˆåŠŸäº† â€¦ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†æ‰€è°“çš„é¢„æ£€è¯·æ±‚ OPETION ã€‚ ä½†æ˜¯ æ¯æ¬¡è¯·æ±‚éƒ½å»åšä¸€æ¬¡ é¢„æ£€è¯·æ±‚ æ¯”è¾ƒæµªè´¹æµé‡ï¼Œå½±å“æ•ˆç‡ï¼Œ æˆ‘ä»¬å¯ä»¥åœ¨ç›¸åº”å¤´ä¸­å¢åŠ  <code class="language-plaintext highlighter-rouge">Access-Control-Max-Age:3600</code> æ¥è®¾ç½®Opetionæ“ä½œçš„ç¼“å­˜æ—¶é—´ï¼Œ è¿™æ ·åœ¨ç¼“å­˜ç”Ÿæ•ˆæ—¶é—´å†…å°±ä¸éœ€è¦å†æ¬¡è¿›è¡ŒOpetionè¯·æ±‚äº†ã€‚</p>

<h3 id="heading--ä¸æ˜¯ä¸‡èƒ½çš„">* ä¸æ˜¯ä¸‡èƒ½çš„</h3>

<p><code class="language-plaintext highlighter-rouge">Access-Control-Allow-Origin:*</code> å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œ å½“è¯·æ±‚æºå¸¦cookieçš„æ—¶å€™ï¼Œ æµè§ˆå™¨æ˜¯ä¸å…è®¸ ä½¿ç”¨<code class="language-plaintext highlighter-rouge">*</code> é€šé…ç¬¦çš„ï¼Œ æ‰€ä»¥å½“å¸¦cookieçš„æ—¶å€™ï¼Œ<code class="language-plaintext highlighter-rouge">Access-Control-Allow-Origin</code> è¿™ä¸ªå­—æ®µå¿…é¡»æ˜¯å…¨åŒ¹é…çš„ã€‚ è€Œä¸”è¿˜éœ€è¦å¢åŠ ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Access-Control-Allow-Credentials:true</code> è¿™ä¸ªç›¸åº”å¤´ã€‚</p>

<h3 id="heading-è‡ªå®šä¹‰è¯·æ±‚å¤´">è‡ªå®šä¹‰è¯·æ±‚å¤´</h3>

<p>å½“ajax è¯·æ±‚ å¸¦è‡ªå®šä¹‰è¯·æ±‚å¤´çš„æ—¶å€™ï¼Œåç«¯ç›¸åº”ä¹Ÿå¿…é¡»å¸¦ä¸Šç›¸åº”çš„è¯·æ±‚å¤´ï¼Œ ä¸ç„¶ä»ç„¶ä¼šå‡ºç° è·¨åŸŸå¼‚å¸¸</p>

<h1 id="heading-æ€»ç»“">æ€»ç»“</h1>

<p>æˆ‘ä»¬ä» <strong>ä¸ºä»€ä¹ˆä¼šè§£å†³è·¨åŸŸ</strong> åˆ° <strong>æ ¹æ®è·¨åŸŸäº§ç”Ÿçš„åŸå› è§£å†³è·¨åŸŸ</strong> é˜è¿°äº†è·¨åŸŸ å’Œ è§£å†³åŠæ³•ï¼Œ è¿™æ ·åœ¨æˆ‘ä»¬å¹³æ—¶å†é‡åˆ°è·¨åŸŸçš„æ—¶å€™å°±å¯ä»¥å˜å¾—æ›´åŠ ä»å®¹ï¼Œ å¦‚æœ è°ƒç”¨æ–¹ å’Œ è¢«è°ƒç”¨æ–¹ éƒ½æ˜¯ä½ è‡ªå·±ï¼Œ å¯ä»¥é€‰æ‹© è¢«è°ƒç”¨æ–¹è§£å†³è·¨åŸŸï¼Œ ä¿®æ”¹ä¸‹æœåŠ¡å™¨çš„ä»£ç å³å¯ã€‚  å¦‚æœä½ æ˜¯è°ƒç”¨æ–¹ï¼Œ è¢«è°ƒç”¨æ–¹æ˜¯åˆ«äººï¼Œ é‚£ä¹ˆ å¯ä»¥ä½¿ç”¨ nginx å¯¹è·¨åŸŸè¿›è¡Œéšè—ã€‚</p>
:ET